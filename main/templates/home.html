{% extends 'base.html' %}

{% block javascript %}
    <script src="static/desc_editor.js?t=32328"></script>
    <script>
        function fill_category_hidden(value) {
            var $category_hidden = $('#id_category')
            $category_hidden.val(value)
        }
        function fill_due_datehour_hidden(date_str) {
            var $due_datehour_hidden = $('#id_due_datehour')
            $due_datehour_hidden.val(date_str)
        }
        function toggle_form() {
            var $new_form = $('#id_new_form')
            var $update_form = $('#id_update_form')
            $new_form.hide()
            $update_form.show()
        }
        function edit(id) {
            console.log('edit(' + id + ')')
            toggle_form()
            
            var $update_form = $('#id_update_form')
            var $id_row = $('#row_'+id)
            $update_form.find('#id_title').val($($id_row.find('td')[1]).text())

            $update_form.attr('action', 'update/' + id + '/')
        }
        function del(id) {
            console.log('delete(' + id + ')')
            var $form = $('#id_del_form')
            $form.attr('action', 'delete/' + id + '/')
            $form[0].submit()
        }
    </script>
{% endblock javascript %}

{% block form %}
    <form id="id_new_form" method="POST" action="{% url 'new' %}">
        {{ test_obj }}
        {{ form.as_ul }}
        <input type="hidden" name="lifemark_id" />
        <input id='id_existing_categories' />
        <input id='id_due_date' />
        <input id='id_due_hour' />
        {% csrf_token %}
        <button type="submit" id="id_btn_add">add lifemark</button>
    </form>
    <form id="id_update_form" method="POST" action="">
        {{ test_obj }}
        {{ form.as_ul }}
        <input type="hidden" name="lifemark_id" />
        <input id='id_existing_categories' />
        <input id='id_due_date' />
        <input id='id_due_hour' />
        {% csrf_token %}
        <button type="submit" id="id_btn_update">update lifemark</button>
    </form>
{% endblock form %}

{% block list %}
    <form id="id_del_form" method="POST" action="">
        {% csrf_token %}
        <table id="list_recent">
            {% for lifemark in lifemarks %}
                <tr id="row_{{ lifemark.id }}">
                    <td>{{ lifemark.id }}</td>
                    <td>{{ lifemark.title }}</td>
                    <td>{{ lifemark.link }}</td>
                    <td>
                        <button id="id_list_btn_edit_{{ lifemark.id }}" type="button" onclick="edit({{ lifemark.id }})">Edit</button>
                        <button id="id_list_btn_del_{{ lifemark.id }}" type="button" onclick="del({{ lifemark.id }})">Del</button>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </form>
{% endblock list %}

{% block init_javascript %}
    <script>
        $('#id_update_form').hide()
    </script>
{% endblock init_javascript %}
