{% extends 'base.html' %}

{% load static nbsp_filter %}

{% block javascript %}
    <script src="{% static 'js/desc_editor.js' %}"></script>
    <script>
        function fill_category_hidden(value) {
            var $category_hidden = $('#id_category')
            $category_hidden.val(value)
        }
        function fill_due_datehour_hidden(date_str) {
            var $due_datehour_hidden = $('#id_due_datehour')
            $due_datehour_hidden.val(date_str)
        }
        function toggle_form() {
            var $new_form = $('#id_new_form')
            var $update_form = $('#id_update_form')
            $new_form.hide()
            $update_form.show()
        }
        function edit(id) {
            console.log('edit(' + id + ')')
            toggle_form()
            
            var $update_form = $('#id_update_form')
            var $id_row = $('#row_'+id)
            $update_form.find('#id_title').val($($id_row.find('td')[1]).text())

            $update_form.attr('action', 'update/' + id + '/')
        }
        function del(id) {
            console.log('delete(' + id + ')')
            var $form = $('#id_del_form')
            $form.attr('action', 'delete/' + id + '/')
            $form[0].submit()
        }
    </script>
{% endblock javascript %}

{% block form %}
    <form class="form-horizontal" id="id_new_form" method="POST" action="{% url 'new' %}">
        {% csrf_token %}
        <div class="form-group">
            <div class="col-sm-12">
                <button type="submit" class="btn btn-default">Add Lifemark</button>
            </div>
        </div>
        {% include 'includes/lifemark_form.html' %}
    </form>
    <form class="form-horizontal" id="id_update_form" method="POST" action="">
        {% csrf_token %}
        <div class="form-group">
            <div class="col-sm-12">
                <button type="submit" class="btn btn-default">Update Lifemark</button>
                <button type="button" class="btn btn-default">Cancel</button>
            </div>
        </div>
        {% include 'includes/lifemark_form.html' %}
    </form>
{% endblock form %}

{% block content %}
    <form id="id_del_form" method="POST" action="">
        {% csrf_token %}

        <div class="row">
            <div class="col-sm-2">
                <button type="button" class="btn btn-default" id="id_btn_search">Search</button>
            </div>
            <div class="col-sm-10">
                <input type="text" class="form-control">
            </div>
        </div>

        <table id="list_recent" class="table table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Link</th>
                    <th>Buttons</th>
                </tr>
            </thead>
            <tbody>
                {% for lifemark in lifemarks %}
                    <tr id="row_{{ lifemark.id }}">
                        <td>{{ lifemark.id }}</td>
                        <td>{{ lifemark.title }}</td>
                        <td>{{ lifemark.link }}</td>
                        <td>
                            <button id="id_list_btn_edit_{{ lifemark.id }}" type="button" onclick="edit({{ lifemark.id }})">Edit</button>
                            <button id="id_list_btn_del_{{ lifemark.id }}" type="button" onclick="del({{ lifemark.id }})">Del</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <table id="id_detail_list" class="table">
            <tbody>
                {% for lifemark in lifemarks %}
                    <tr id="row_{{ lifemark.id }}">
                        <td>
                            {{ lifemark.id }}
                            <button type="button" class="btn btn-default">Del</button>
                            <button type="button" class="btn btn-default">Edit</button>
                            <button type="button" class="btn btn-default">Map</button>
                            <button type="button" class="btn btn-default">Recent Map</button>
                            <button type="button" class="btn btn-default">Copy</button>
                            <p>Title: {{ lifemark.title }}</p>
                            <p>cdate: {{ lifemark.cdate }}</p>
                            <p>udate: {{ lifemark.udate }}</p>
                            <p>category: {{ lifemark.category }}</p>
                            <p>state: {{ lifemark.is_complete }}</p>
                            <p>tags: {{ lifemark.tags }}</p>
                            {% if lifemark.desc %}
                                <p>{{ lifemark.desc|nbsp|linebreaks }}</p>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    </form>
{% endblock content %}

{% block init_javascript %}
    <script>
        $('#id_update_form').hide()
    </script>
{% endblock init_javascript %}
